# Default values for olake.
# This is a YAML-formatted file.
# Declare variables to be substituted into your templates.

global:
  # Global image settings
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: "standard"

# Namespace configuration
namespace:
  name: olake
  create: true

# PostgreSQL configuration
postgresql:
  enabled: true
  replicaCount: 1
  
  image:
    repository: postgres
    tag: "14-alpine"
    pullPolicy: IfNotPresent
  
  auth:
    postgresPassword: temporal
    username: temporal
    password: temporal
    database: temporal
  
  nodeSelector: {}
  tolerations: []
  affinity: {}
  
  podAnnotations: {}
  podLabels: {}
  
  livenessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
    exec:
      command:
        - /bin/sh
        - -c
        - exec pg_isready -U "temporal" -h 127.0.0.1 -p 5432
  
  readinessProbe:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
    exec:
      command:
        - /bin/sh
        - -c
        - exec pg_isready -U "temporal" -h 127.0.0.1 -p 5432
  
  service:
    type: ClusterIP
    port: 5432
    targetPort: 5432
    annotations: {}
  
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  
  persistence:
    enabled: true
    storageClass: ""
    size: 8Gi
    accessModes:
      - ReadWriteOnce

# Elasticsearch configuration
elasticsearch:
  enabled: true
  replicaCount: 1
  
  image:
    repository: docker.elastic.co/elasticsearch/elasticsearch
    tag: "8.8.0"
    pullPolicy: IfNotPresent
  
  nodeSelector: {}
  tolerations: []
  affinity: {}
  
  podAnnotations: {}
  podLabels: {}
  
  livenessProbe:
    enabled: true
    initialDelaySeconds: 90
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
    httpGet:
      path: /_cluster/health?local=true
      port: 9200
  
  readinessProbe:
    enabled: true
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
    httpGet:
      path: /_cluster/health?local=true
      port: 9200
  
  service:
    type: ClusterIP
    port: 9200
    targetPort: 9200
    annotations: {}
  
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"
  
  env:
    - name: discovery.type
      value: single-node
    - name: ES_JAVA_OPTS
      value: "-Xms512m -Xmx512m"
    - name: xpack.security.enabled
      value: "false"

# Temporal configuration
temporal:
  enabled: true
  
  server:
    replicaCount: 1
    
    image:
      repository: temporalio/auto-setup
      tag: "1.22.0"
      pullPolicy: IfNotPresent
    
    nodeSelector: {}
    tolerations: []
    affinity: {}
    
    podAnnotations: {}
    podLabels: {}
    
    livenessProbe:
      enabled: true
      initialDelaySeconds: 150
      periodSeconds: 60
      timeoutSeconds: 10
      failureThreshold: 3
      successThreshold: 1
      tcpSocket:
        port: 7233
    
    readinessProbe:
      enabled: true
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
      successThreshold: 1
      tcpSocket:
        port: 7233
    
    service:
      type: ClusterIP
      port: 7233
      targetPort: 7233
      annotations: {}
    
    resources:
      requests:
        memory: "512Mi"
        cpu: "500m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
    
    env:
      - name: DB
        value: postgresql
      - name: DB_PORT
        value: "5432"
      - name: POSTGRES_USER
        value: temporal
      - name: POSTGRES_PWD
        value: temporal
      - name: POSTGRES_SEEDS
        value: postgresql.olake.svc.cluster.local
      - name: DYNAMIC_CONFIG_FILE_PATH
        value: config/dynamicconfig/development-sql.yaml
      - name: ENABLE_ES
        value: "true"
      - name: ES_SEEDS
        value: elasticsearch.olake.svc.cluster.local
      - name: ES_VERSION
        value: v8
  
  ui:
    enabled: true
    replicaCount: 1
    
    image:
      repository: temporalio/ui
      tag: "2.21.3"
      pullPolicy: IfNotPresent
    
    nodeSelector: {}
    tolerations: []
    affinity: {}
    
    podAnnotations: {}
    podLabels: {}
    
    livenessProbe:
      enabled: true
      initialDelaySeconds: 30
      periodSeconds: 30
      timeoutSeconds: 10
      failureThreshold: 3
      successThreshold: 1
      httpGet:
        path: /
        port: 8080
    
    readinessProbe:
      enabled: true
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
      successThreshold: 1
      httpGet:
        path: /
        port: 8080
    
    service:
      type: NodePort
      port: 8080
      targetPort: 8080
      nodePort: 30080
      annotations: {}
    
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"
    
    env:
      - name: TEMPORAL_ADDRESS
        value: temporal.olake.svc.cluster.local:7233
      - name: TEMPORAL_CORS_ORIGINS
        value: http://localhost:3000

# OLake UI (Main Application) configuration
olakeUI:
  enabled: true
  replicaCount: 1
  
  image:
    repository: olake-ui
    tag: local
    pullPolicy: Never
  
  nodeSelector: {}
  tolerations: []
  affinity: {}
  
  podAnnotations: {}
  podLabels: {}
  
  livenessProbe:
    enabled: true
    initialDelaySeconds: 60
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
    successThreshold: 1
    httpGet:
      path: /health
      port: 8080
  
  readinessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
    httpGet:
      path: /health
      port: 8080
  
  service:
    type: NodePort
    ports:
      backend: 8080
      frontend: 3000
    nodePorts:
      backend: 30081
      frontend: 30082
    annotations: {}
  
  # Ingress configuration
  ingress:
    enabled: false
    className: ""
    annotations: {}
      # kubernetes.io/ingress.class: nginx
      # kubernetes.io/tls-acme: "true"
    hosts:
      - host: olake.local
        paths:
          - path: /
            pathType: Prefix
    tls: []
    #  - secretName: olake-tls
    #    hosts:
    #      - olake.local
  
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  
  config:
    database:
      host: postgresql.olake.svc.cluster.local
      port: 5432
      name: postgres
      user: temporal
      password: temporal
    temporal:
      host: temporal.olake.svc.cluster.local
      port: 7233
      taskQueue: OLAKE_TASK_QUEUE
  
  # Initialization job for user signup
  initJob:
    enabled: true
    image:
      repository: olake-ui
      tag: local
      pullPolicy: Never
    resources:
      requests:
        memory: "256Mi"
        cpu: "250m"
      limits:
        memory: "512Mi"
        cpu: "500m"

# OLake K8s Worker configuration
olakeWorker:
  enabled: true
  replicaCount: 1
  
  image:
    repository: olake-k8s-worker
    tag: local
    pullPolicy: Never
  
  nodeSelector: {}
  tolerations: []
  affinity: {}
  
  podAnnotations: {}
  podLabels: {}
  
  livenessProbe:
    enabled: true
    initialDelaySeconds: 60
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
    successThreshold: 1
    httpGet:
      path: /health
      port: 8090
  
  readinessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
    httpGet:
      path: /health
      port: 8090
  
  service:
    type: ClusterIP
    port: 8090
    targetPort: 8090
    annotations: {}
  
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  
  # Service Account for Kubernetes API access
  serviceAccount:
    create: true
    name: olake-k8s-worker
    annotations: {}
  
  # RBAC permissions - PODS ONLY
  rbac:
    create: true
    rules:
      - apiGroups: [""]
        resources: ["pods", "pods/log"]
        verbs: ["get", "list", "create", "delete", "watch"]
  
  config:
    kubernetes:
      namespace: olake
      imageRegistry: olakego
      imagePullPolicy: IfNotPresent
      serviceAccount: olake-k8s-worker
      storagePvcName: olake-jobs-pvc
    
    temporal:
      address: temporal.olake.svc.cluster.local:7233
      taskQueue: OLAKE_K8S_TASK_QUEUE
    
    database:
      host: postgresql.olake.svc.cluster.local
      port: "5432"
      user: temporal
      password: temporal
      name: postgres
      sslmode: disable
    
    worker:
      maxConcurrentActivities: 10
      maxConcurrentWorkflows: 5
    
    timeouts:
      workflow:
        discover: 2h
        test: 2h
        sync: 720h  # 30 days
      activity:
        discover: 30m
        test: 30m
        sync: 700h  # 29 days

# Storage configuration
storage:
  # Persistent Volume for shared job storage
  persistentVolume:
    enabled: true
    name: olake-jobs-pv
    capacity: 10Gi
    accessModes:
      - ReadWriteMany
    reclaimPolicy: Retain
    storageClassName: olake-jobs
    hostPath: /data/olake-jobs
  
  # Persistent Volume Claim
  persistentVolumeClaim:
    enabled: true
    name: olake-jobs-pvc
    accessModes:
      - ReadWriteOnce
    storageClassName: standard
    size: 10Gi

# Security settings
securityContext:
  runAsUser: 0
  fsGroup: 0
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# Node selector and tolerations
nodeSelector: {}
tolerations: []
affinity: {}
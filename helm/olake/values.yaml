# Default values for OLake.
# This is a YAML-formatted file.
# Declare variables to be substituted into your templates.

# =============================================================================
# GLOBAL CONFIGURATION
# =============================================================================

# -- Override the deployment namespace
namespaceOverride: "olake"

# -- Provide a name in place of olake for `app:` labels
nameOverride: ""

# -- Provide a name to substitute for the full names of resources
fullnameOverride: ""

# -- Global configuration that applies to all components
global:
  # -- Global image registry to use for all images
  # Examples:
  #   registry.example.com
  #   harbor.company.com/olake
  imageRegistry: ""
  
  # -- Global image pull secrets
  # Examples:
  #   - name: myRegistryKeySecretName
  imagePullSecrets: []
  
  # -- Global storage class for all persistent volumes
  # Set to "-" to disable dynamic provisioning
  # Examples: gp2, fast, standard, local-path
  storageClass: ""
  
  # -- Global security context applied to all pods
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    seccompProfile:
      type: RuntimeDefault

# =============================================================================
# NAMESPACE CONFIGURATION
# =============================================================================

# -- Namespace configuration
namespace:
  # -- Name of the namespace where all resources will be deployed
  name: olake
  
  # -- Whether to create the namespace if it doesn't exist
  create: true
  
  # -- Additional labels for the namespace
  labels: {}
  
  # -- Additional annotations for the namespace
  annotations: {}

# =============================================================================
# OLAKE MAIN APPLICATION
# =============================================================================

# OLake UI - Main application frontend and backend
olakeUI:
  # -- Enable OLake UI deployment
  enabled: true
  
  # -- Number of OLake UI replicas
  # For production, consider 2+ replicas for high availability
  replicaCount: 1
  
  # -- OLake UI image configuration
  image:
    # -- OLake UI image repository
    repository: dzipstagingacr.azurecr.io/olake-ui
    
    # -- OLake UI image tag
    # Use 'local' for development, specific version for production
    tag: latest
    
    # -- Image pull policy
    # Use 'Never' for local development, 'Always' for production
    pullPolicy: Always
  
  # -- Pod scheduling constraints
  nodeSelector: {}
  
  # -- Tolerations for pod assignment
  tolerations: []
  
  # -- Affinity settings for pod assignment
  affinity: {}
  
  # -- Additional pod annotations
  podAnnotations: {}
  
  # -- Additional pod labels
  podLabels: {}
  
  # -- OLake UI readiness probe override (optional)
  # Defaults: initialDelaySeconds: 30, periodSeconds: 10, timeoutSeconds: 5,
  #           failureThreshold: 3, successThreshold: 1, tcpSocket: port 8080
  # Example customizations:
  #   readinessProbe:
  #     initialDelaySeconds: 45
  #     httpGet:
  #       path: /health
  #       port: 8080
  readinessProbe: {}
  
  # -- OLake UI liveness probe override (optional)
  # Defaults: initialDelaySeconds: 60, periodSeconds: 30, timeoutSeconds: 10,
  #           failureThreshold: 3, successThreshold: 1, tcpSocket: port 8080
  # Example customizations:
  #   livenessProbe:
  #     periodSeconds: 60
  #     httpGet:
  #       path: /health
  #       port: 8080
  livenessProbe: {}
  
  # -- OLake UI service configuration
  # For external access, change type to NodePort or LoadBalancer  
  service:
    # -- Service type (ClusterIP for internal, NodePort/LoadBalancer for external access)
    type: ClusterIP
    # -- Service annotations
    annotations: {}
  
  # -- Ingress configuration for external access
  ingress:
    # -- Enable ingress
    enabled: false
    
    # -- Ingress class name
    # Examples: nginx, traefik, alb
    className: ""
    
    # -- Ingress annotations
    annotations: {}
      # nginx.ingress.kubernetes.io/rewrite-target: /
      # kubernetes.io/ingress.class: nginx
      # kubernetes.io/tls-acme: "true"
      # cert-manager.io/cluster-issuer: "letsencrypt-prod"
    
    # -- Ingress hosts configuration
    hosts:
      - host: olake.local
        paths:
          - path: /
            pathType: Prefix
    
    # -- TLS configuration
    tls: []
    #  - secretName: olake-tls
    #    hosts:
    #      - olake.example.com
  
  # -- OLake UI resource requirements (optional overrides)
  # Defaults: requests: memory=512Mi, cpu=500m (no limits by default)
  # Example customizations:
  #   resources:
  #     requests:
  #       memory: "1Gi"
  #       cpu: "750m"
  #     limits:
  #       memory: "2Gi"
  #       cpu: "1500m"
  resources: {}
  
  # -- Initialization job configuration (always enabled)
  initJob:
    # -- Admin user credentials for initial setup
    adminUser:
      # -- Admin username
      username: "admin"
      
      # -- Admin password (change this in production!)
      password: "password"
      
      # -- Admin email address
      email: "admin@example.com"
    
    # -- Initialization job resource requirements (optional overrides)
    # Defaults: requests: memory=128Mi, cpu=100m (no limits by default)
    # Example customizations:
    #   resources:
    #     requests:
    #       memory: "256Mi"
    #       cpu: "200m"
    #     limits:
    #       memory: "512Mi"
    #       cpu: "400m"
    resources: {}

# =============================================================================
# OLAKE KUBERNETES WORKER
# =============================================================================

# OLake K8s Worker - Executes data pipeline tasks as Kubernetes pods
olakeWorker:
  # -- Enable OLake K8s Worker deployment
  enabled: true
  
  # -- Number of OLake Worker replicas
  # Multiple replicas can handle more concurrent workflows
  replicaCount: 1
  
  # -- OLake Worker image configuration
  image:
    # -- OLake Worker image repository
    repository: dzipstagingacr.azurecr.io/olake-k8s-worker
    
    # -- OLake Worker image tag
    # Use 'local' for development, specific version for production
    tag: latest
    
    # -- Image pull policy
    # Use 'Never' for local development, 'Always' for production
    pullPolicy: Always
  
  # -- Pod scheduling constraints
  nodeSelector: {}
  
  # -- Tolerations for pod assignment
  tolerations: []
  
  # -- Affinity settings for pod assignment
  affinity: {}
  
  # -- Additional pod annotations
  podAnnotations: {}
  
  # -- Additional pod labels
  podLabels: {}
  
  # -- OLake Worker readiness probe override (optional)
  # Defaults: initialDelaySeconds: 30, periodSeconds: 10, timeoutSeconds: 5,
  #           failureThreshold: 3, successThreshold: 1, httpGet: /health on port 8090
  # Example customizations:
  #   readinessProbe:
  #     initialDelaySeconds: 45
  #     httpGet:
  #       path: /healthz
  #       port: 8090
  readinessProbe: {}
  
  # -- OLake Worker liveness probe override (optional)
  # Defaults: initialDelaySeconds: 60, periodSeconds: 30, timeoutSeconds: 10,
  #           failureThreshold: 3, successThreshold: 1, httpGet: /health on port 8090
  # Example customizations:
  #   livenessProbe:
  #     periodSeconds: 60
  livenessProbe: {}
  
  # -- Service is hardcoded: ClusterIP on port 8090 for health checks
  
  # -- OLake Worker resource requirements (optional overrides)
  # Defaults: requests: memory=256Mi, cpu=250m (no limits by default)
  # Example customizations:
  #   resources:
  #     requests:
  #       memory: "512Mi"
  #       cpu: "500m"
  #     limits:
  #       memory: "1Gi"
  #       cpu: "1000m"
  resources: {}
  
  # -- Service Account configuration for Kubernetes API access
  serviceAccount:
    # -- Create service account
    create: true
    
    # -- Service account name
    # If not set and create is true, a name is generated using the fullname template
    name: ""
    
    # -- Service account annotations
    annotations: {}
  
  # -- RBAC permissions are hardcoded with least privilege principle:
  # - Pods: get, list, watch, create, delete (no update/patch)
  # - Pod logs/status: get, list, watch (read-only)
  # - Jobs: full management for batch processing
  # - ConfigMaps/Secrets: get, list, watch (read-only)
  
  # -- OLake Worker application configuration
  config:
    # -- Kubernetes-specific configuration
    kubernetes:
      # -- Namespace for job execution (templated)
      namespace: "{{ .Values.namespace.name }}"
      
      # -- Image registry for job containers
      # This should point to where your connector images are stored
      imageRegistry: olakego
      
      # -- Image pull policy for job containers
      imagePullPolicy: IfNotPresent
      
      # -- Service account for job pods (templated)
      serviceAccount: "{{ include \"olake.workerServiceAccountName\" . }}"
      
      # -- PVC name for shared storage (templated)
      storagePvcName: "{{ include \"olake.sharedStoragePVC\" . }}"
    
    # -- Temporal connection configuration
    temporal:
      # -- Temporal server address
      address: "temporal.{{ .Values.namespace.name }}.svc.cluster.local:7233"
      
      # -- Temporal task queue name for K8s worker
      taskQueue: OLAKE_K8S_TASK_QUEUE
    
    # -- Database connection configuration
    database:
      # -- Database host (templated)
      host: "postgresql.{{ .Values.namespace.name }}.svc.cluster.local"
      
      # -- Database port
      port: "5432"
      
      # -- Database user (templated from PostgreSQL superuser)
      user: "{{ .Values.postgresql.auth.postgresUser }}"
      
      # -- Database password (templated from PostgreSQL superuser)
      password: "{{ .Values.postgresql.auth.postgresPassword }}"
      
      # -- Database name (use default postgres database)
      name: "postgres"
      
      # -- SSL mode for database connection
      sslmode: disable
    
    # -- Worker performance configuration
    worker:
      # -- Maximum concurrent activities per worker
      # Increase for higher throughput, decrease for resource constraints
      maxConcurrentActivities: 10
      
      # -- Maximum concurrent workflows per worker
      # Usually lower than activities
      maxConcurrentWorkflows: 5
    
    # -- Timeout configuration for different operation types
    timeouts:
      # -- Workflow execution timeouts
      workflow:
        # -- Timeout for catalog discovery workflows
        discover: 2h
        
        # -- Timeout for connection test workflows
        test: 2h
        
        # -- Timeout for data sync workflows (30 days)
        sync: 720h
      
      # -- Activity execution timeouts
      activity:
        # -- Timeout for catalog discovery activities
        discover: 30m
        
        # -- Timeout for connection test activities
        test: 30m
        
        # -- Timeout for data sync activities (29 days, slightly less than workflow)
        sync: 700h
    
    # -- Job execution configuration
    job:
      # -- TTL for completed jobs (seconds)
      ttlSeconds: 3600
      
      # -- Backoff limit for failed jobs
      backoffLimit: 3
      
      # -- Number of parallel job pods
      parallelism: 1
      
      # -- Number of successful completions required
      completions: 1
    
    # -- Health check configuration
    healthCheck:
      # -- Port for health check endpoint
      port: 8090
    
    # -- Logging configuration
    logging:
      # -- Log level (debug, info, warn, error)
      level: info
      
      # -- Log format (json, text)
      format: json

# =============================================================================
# STORAGE CONFIGURATION
# =============================================================================

# Storage configuration for shared data exchange between pods
# Choose between self-managed NFS server or external storage (EFS/Azure Files)
nfsServer:
  # -- Enable self-managed NFS server deployment
  # When false, you must provide external storage (EFS/Azure Files/etc.)
  enabled: true
  
  # -- External storage configuration (used when enabled: false)
  external:
    # -- PVC name for external storage
    name: olake-jobs-pvc
    
    # -- Storage size for external storage
    size: 10Gi
  
  # -- Number of NFS server replicas (should be 1 for StatefulSet)
  replicaCount: 1
  
  # -- NFS server image configuration
  image:
    # -- NFS server image repository
    repository: itsthenetwork/nfs-server-alpine
    
    # -- NFS server image tag
    tag: "latest"
    
    # -- Image pull policy
    pullPolicy: Always
  
  # -- Pod scheduling constraints
  nodeSelector: {}
  
  # -- Tolerations for pod assignment
  tolerations: []
  
  # -- Affinity settings for pod assignment
  affinity: {}
  
  # -- Additional pod annotations
  podAnnotations: {}
  
  # -- Additional pod labels
  podLabels: {}
  
  # -- NFS server resource requirements
  resources:
    requests:
      # -- Memory request
      memory: "256Mi"
      # -- CPU request
      cpu: "250m"
    limits:
      # -- Memory limit
      memory: "512Mi"
      # -- CPU limit
      cpu: "500m"
  
  # -- NFS server persistence configuration
  # This is the underlying storage for the NFS server itself
  persistence:
    # -- Size of underlying storage for NFS server
    size: 20Gi
    
    # -- Access modes for underlying storage
    accessModes:
      - ReadWriteOnce

# =============================================================================
# TEMPORAL WORKFLOW ENGINE
# =============================================================================

# Temporal configuration for workflow orchestration
temporal:
  # -- Enable Temporal deployment
  enabled: true
  
  # -- Temporal server configuration
  server:
    # -- Number of Temporal server replicas
    # For production, consider 3+ replicas for high availability
    replicaCount: 1
    
    # -- Temporal server image configuration
    image:
      # -- Temporal server image repository
      repository: temporalio/auto-setup
      
      # -- Temporal server image tag
      # Check https://hub.docker.com/r/temporalio/auto-setup/tags for latest versions
      tag: "1.22.3"
      
      # -- Image pull policy
      pullPolicy: Always
    
    # -- Pod scheduling constraints
    nodeSelector: {}
    
    # -- Tolerations for pod assignment
    tolerations: []
    
    # -- Affinity settings for pod assignment
    affinity: {}
    
    # -- Additional pod annotations
    podAnnotations: {}
    
    # -- Additional pod labels
    podLabels: {}
    
    # -- Temporal server readiness probe override (optional)
    # Defaults: initialDelaySeconds: 10, periodSeconds: 10, timeoutSeconds: 5,
    #           failureThreshold: 3, successThreshold: 1, tcpSocket: port 7233
    # Example customizations:
    #   readinessProbe:
    #     initialDelaySeconds: 15
    readinessProbe: {}
    
    # -- Temporal server liveness probe override (optional)
    # Defaults: initialDelaySeconds: 150, periodSeconds: 60, timeoutSeconds: 10,
    #           failureThreshold: 3, successThreshold: 1, tcpSocket: port 7233
    # Example customizations:
    #   livenessProbe:
    #     initialDelaySeconds: 120
    livenessProbe: {}
    
    # -- Temporal server service annotations (optional)
    service:
      annotations: {}
    
    # -- Temporal server resource requirements (optional overrides)
    # Defaults: requests: memory=512Mi, cpu=500m (no limits by default)
    # Example customizations:
    #   resources:
    #     requests:
    #       memory: "1Gi"
    #       cpu: "750m"
    #     limits:
    #       memory: "2Gi"
    #       cpu: "1500m"
    resources: {}
    
    # -- Temporal server environment variables
    env:
      # -- Database type
      - name: DB
        value: postgres12
      
      # -- Database port
      - name: DB_PORT
        value: "5432"
      
      # -- PostgreSQL user (templated from postgresql.auth.postgresUser)
      - name: POSTGRES_USER
        value: "{{ .Values.postgresql.auth.postgresUser }}"
      
      # -- PostgreSQL password (templated from postgresql.auth.postgresPassword)
      - name: POSTGRES_PWD
        value: "{{ .Values.postgresql.auth.postgresPassword }}"
      
      # -- PostgreSQL seeds (templated service name)
      - name: POSTGRES_SEEDS
        value: "postgresql.{{ .Values.namespace.name }}.svc.cluster.local"
      
      # -- Enable Elasticsearch for advanced visibility
      - name: ENABLE_ES
        value: "true"
      
      # -- Elasticsearch seeds (templated service name)
      - name: ES_SEEDS
        value: "elasticsearch.{{ .Values.namespace.name }}.svc.cluster.local"
      
      # -- Elasticsearch version
      - name: ES_VERSION
        value: v7
  
  # -- Temporal Web UI configuration
  ui:
    # -- Enable Temporal Web UI
    enabled: true
    
    # -- Number of Temporal UI replicas
    replicaCount: 1
    
    # -- Temporal UI image configuration
    image:
      # -- Temporal UI image repository
      repository: temporalio/ui
      
      # -- Temporal UI image tag
      # Check https://hub.docker.com/r/temporalio/ui/tags for latest versions
      tag: "2.16.2"
      
      # -- Image pull policy
      pullPolicy: Always
    
    # -- Pod scheduling constraints
    nodeSelector: {}
    
    # -- Tolerations for pod assignment
    tolerations: []
    
    # -- Affinity settings for pod assignment
    affinity: {}
    
    # -- Additional pod annotations
    podAnnotations: {}
    
    # -- Additional pod labels
    podLabels: {}
    
    # -- Temporal UI readiness probe override (optional)
    # Defaults: initialDelaySeconds: 10, periodSeconds: 10, timeoutSeconds: 5,
    #           failureThreshold: 3, successThreshold: 1, httpGet: / on port 8081
    # Example customizations:
    #   readinessProbe:
    #     initialDelaySeconds: 15
    readinessProbe: {}
    
    # -- Temporal UI liveness probe override (optional)
    # Defaults: initialDelaySeconds: 30, periodSeconds: 30, timeoutSeconds: 10,
    #           failureThreshold: 3, successThreshold: 1, httpGet: / on port 8081
    # Example customizations:
    #   livenessProbe:
    #     periodSeconds: 60
    livenessProbe: {}
    
    # -- Temporal UI service configuration
    # For external access, change type to NodePort or LoadBalancer
    service:
      # -- Service type (ClusterIP for internal, NodePort/LoadBalancer for external access)
      type: ClusterIP
      # -- NodePort (when service type is NodePort)
      nodePort: 30080
      # -- Service annotations
      annotations: {}
    
    # -- Temporal UI resource requirements (optional overrides)
    # Defaults: requests: memory=128Mi, cpu=100m (no limits by default)
    # Example customizations:
    #   resources:
    #     requests:
    #       memory: "256Mi"
    #       cpu: "200m"
    #     limits:
    #       memory: "512Mi"
    #       cpu: "400m"
    resources: {}
    
    # -- Temporal UI environment variables
    env:
      # -- Temporal server address
      - name: TEMPORAL_ADDRESS
        value: "temporal.{{ .Values.namespace.name }}.svc.cluster.local:7233"
      
      # -- Temporal UI port
      - name: TEMPORAL_UI_PORT
        value: "8081"
      
      # -- CORS origins for cross-origin requests
      - name: TEMPORAL_CORS_ORIGINS
        value: http://localhost:3000

# =============================================================================
# POSTGRESQL DATABASE
# =============================================================================

# PostgreSQL is used as the backend database for Temporal and OLake
postgresql:
  # -- Enable PostgreSQL deployment
  enabled: true
  
  # -- Number of PostgreSQL replicas
  # Note: PostgreSQL clustering requires additional configuration
  replicaCount: 1
  
  # -- PostgreSQL image configuration
  image:
    # -- PostgreSQL image repository
    repository: postgres
    
    # -- PostgreSQL image tag
    # Supported versions: 12, 13, 14, 15
    tag: "14-alpine"
    
    # -- Image pull policy
    pullPolicy: Always
  
  # -- Authentication configuration
  auth:
    # -- PostgreSQL super user name
    postgresUser: "temporal"
    
    # -- PostgreSQL super user password
    # In production, consider using existingSecret
    postgresPassword: "temporal"
    
    # -- PostgreSQL application database
    database: "temporal"
    
    # -- Name of existing secret containing PostgreSQL credentials
    # Keys: postgres-password, password, username
    existingSecret: ""
    
    # -- Key in existing secret containing PostgreSQL super user password
    secretKeys:
      adminPasswordKey: postgres-password
      userPasswordKey: password
      usernameKey: username
  
  # -- Pod scheduling constraints
  nodeSelector: {}
  
  # -- Tolerations for pod assignment
  tolerations: []
  
  # -- Affinity settings for pod assignment
  affinity: {}
  
  # -- Additional pod annotations
  podAnnotations: {}
  
  # -- Additional pod labels
  podLabels: {}
  
  # -- PostgreSQL readiness probe override (optional)
  # Defaults: initialDelaySeconds: 5, periodSeconds: 10, timeoutSeconds: 5,
  #           failureThreshold: 6, successThreshold: 1, exec: pg_isready command
  # Example customizations:
  #   readinessProbe:
  #     initialDelaySeconds: 10
  readinessProbe: {}
  
  # -- PostgreSQL liveness probe override (optional)
  # Defaults: initialDelaySeconds: 30, periodSeconds: 10, timeoutSeconds: 5,
  #           failureThreshold: 6, successThreshold: 1, exec: pg_isready command
  # Example customizations:
  #   livenessProbe:
  #     initialDelaySeconds: 60
  livenessProbe: {}
  
  # -- PostgreSQL service annotations (optional)
  service:
    annotations: {}
  
  # -- PostgreSQL resource requirements (optional overrides)
  # Defaults: requests: memory=256Mi, cpu=250m (no limits by default)
  # Example customizations:
  #   resources:
  #     requests:
  #       memory: "512Mi"
  #       cpu: "500m"
  #     limits:
  #       memory: "1Gi"
  #       cpu: "1000m"
  resources: {}
  
  # -- PostgreSQL persistence configuration
  persistence:
    # -- Enable persistent storage
    enabled: true
    
    # -- Size of persistent volume
    size: 8Gi
    
    # -- Access modes for persistent volume
    accessModes:
      - ReadWriteOnce
    
    # -- Additional annotations for PVC
    annotations: {}

# =============================================================================
# ELASTICSEARCH
# =============================================================================

# Elasticsearch is used by Temporal for advanced visibility features
elasticsearch:
  # -- Enable Elasticsearch deployment
  # Set to false to disable advanced visibility in Temporal
  enabled: true
  
  # -- Number of Elasticsearch replicas
  # For production, consider 3+ replicas for high availability
  replicaCount: 1
  
  # -- Elasticsearch image configuration
  image:
    # -- Elasticsearch image repository
    repository: elasticsearch
    
    # -- Elasticsearch image tag
    # Supported versions: 7.x, 8.x
    tag: "7.17.10"
    
    # -- Image pull policy
    pullPolicy: Always
  
  # -- Pod scheduling constraints
  nodeSelector: {}
  
  # -- Tolerations for pod assignment
  tolerations: []
  
  # -- Affinity settings for pod assignment
  affinity: {}
  
  # -- Additional pod annotations
  podAnnotations: {}
  
  # -- Additional pod labels
  podLabels: {}
  
  # -- Elasticsearch readiness probe override (optional)
  # Defaults: initialDelaySeconds: 10, periodSeconds: 10, timeoutSeconds: 5,
  #           failureThreshold: 3, successThreshold: 1, httpGet: /_cluster/health?local=true on port 9200
  # Example customizations:
  #   readinessProbe:
  #     initialDelaySeconds: 15
  readinessProbe: {}
  
  # -- Elasticsearch liveness probe override (optional)
  # Defaults: initialDelaySeconds: 90, periodSeconds: 10, timeoutSeconds: 5,
  #           failureThreshold: 3, successThreshold: 1, httpGet: /_cluster/health?local=true on port 9200
  # Example customizations:
  #   livenessProbe:
  #     initialDelaySeconds: 120
  livenessProbe: {}
  
  # -- Elasticsearch service annotations (optional)
  service:
    annotations: {}
  
  # -- Elasticsearch resource requirements (optional overrides)
  # Defaults: requests: memory=1Gi, cpu=500m (no limits by default)
  # Example customizations:
  #   resources:
  #     requests:
  #       memory: "2Gi"
  #       cpu: "1000m"
  #     limits:
  #       memory: "4Gi"
  #       cpu: "2000m"
  resources: {}
  
  # -- Elasticsearch environment variables
  env:
    # -- Set Elasticsearch to single-node mode (development only)
    # For production, configure proper clustering
    - name: discovery.type
      value: single-node
    
    # -- Java heap size configuration
    # Should be ~50% of available memory
    - name: ES_JAVA_OPTS
      value: "-Xms512m -Xmx512m"
    
    # -- Disable X-Pack security (development only)
    # For production, enable and configure security
    - name: xpack.security.enabled
      value: "false"